{% extends 'website/templates/base.html' %}
{% load widget_tweaks %}

{% block container %}
{% if messages %}
    <div class="messages"><br>
        {% for message in messages %}
        <div class="alert alert-{{ message.tags }}">
            <button type="button" class="close" data-dismiss="alert" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
            <small>{{ message }}</small>
        </div>
        {% endfor %}
    </div >
{% endif %}
<div class="wrapper">
    <div class="pull-left">
        <h3 class="brand">Simple ToDo</h3>
    </div>
    <div class="pull-right">
        <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#task-modal">
            <span class="glyphicon glyphicon-plus" aria-hidden="true"></span> New Task
        </button>
        <a href="{% url 'user_logout' %}">Logout</a>
    </div>
    <div class="clearfix"></div>

    <br><br>

    <div class="primary">
        <div class="time-filter">
            <i>Filter by:</i> Day / Week / Month
        </div> <!-- .time-filter -->

        <br>

        <table id="tasks" class="table table-bordered table-condensed">
            <thead>
                <th style="width:75px;">#</th>
                <th>Name</th>
                <th>Description</th>
                <th style="width:100px;">Status</th>
                <th>Due Date</th>
                <th>Quick Actions</th>
            </thead>
            <tbody>
            {% for task in tasks %}
                <tr class="{{ task.state }}" data-id="{{ task.id }}">
                    <td>
                        <select class="form-control task-priority">
                            <option value="1" {% if task.priority == 1 %}selected{% endif %}>1</option>
                            <option value="2" {% if task.priority == 2 %}selected{% endif %}>2</option>
                            <option value="3" {% if task.priority == 3 %}selected{% endif %}>3</option>
                            <option value="4" {% if task.priority == 4 %}selected{% endif %}>4</option>
                            <option value="5" {% if task.priority == 5 %}selected{% endif %}>5</option>
                        </select>
                    </td>
                    
                    <td>{{ task.name }}</td>
                    
                    <td>{{ task.description }}</td>
                    
                    <td>
                        <select class="form-control task-state">
                            <option value="todo" {% if task.state == 'todo' %}selected{% endif %}>todo</option>
                            <option value="doing" {% if task.state == 'doing' %}selected{% endif %}>doing</option>
                            <option value="done" {% if task.state == 'done' %}selected{% endif %}>done</option>
                        </select>
                    </td>
                    
                    <td>{{ task.due_date }}</td>
                    
                    <td>
                        <a class='view-task' data-toggle="modal" data-target="#genericModal" href="">
                            <span class="glyphicon glyphicon-eye-open" aria-hidden="true"></span>
                        </a>&nbsp;
                        <a class="edit-task" data-toggle="modal" data-target="#task-modal"href="">
                            <span class="glyphicon glyphicon-edit" aria-hidden="true"></span>
                        </a>&nbsp;
                        <a href=""><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>&nbsp;
                    </td>
                </tr>
            {% endfor %}
            </tbody>
        </table>
    </div> <!-- .primary -->
</div> <!-- .wrapper -->

<!-- task modal -->
<div class="modal fade" id="task-modal" tabindex="-1" role="dialog" aria-labelledby="taskModal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            {% with WIDGET_ERROR_CLASS='field-error' %} 
            <form action="/new-task/" method="POST"> {% csrf_token %}
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title">Add new task</h4>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="id_name">Task Name</label>
                        {% render_field form.name class+='form-control' %}
                    </div>
                    <div class="form-group">
                        <label for="id_description">Task Description</label>
                        {% render_field form.description class+='form-control' %}
                    </div>
                    <div class="form-group">
                        <label for="id_due_date">Due Date</label>
                        {% render_field form.due_date class+='form-control date' %}
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-primary" value="Save">
                </div>
            </form>
            {% endwith %}
        </div><!-- /.modal-content -->
    </div><!-- /.modal-dialog -->
</div><!-- /.modal -->


<!-- generic modal -->
<div class="modal fade" id="genericModal" tabindex="-1" role="dialog" aria-labelledby="genericModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h4 class="modal-title" id="myModalLabel">Task Details</h4>
      </div>
      <div class="modal-body">
      </div>
    </div>
  </div>
</div>
{% endblock %}
